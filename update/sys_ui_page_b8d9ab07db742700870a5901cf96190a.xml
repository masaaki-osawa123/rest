<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ui_page">
    <sys_ui_page action="INSERT_OR_UPDATE">
        <category>general</category>
        <client_script/>
        <description/>
        <direct>false</direct>
        <endpoint>x_276087_request_p_iTunesSearchPage.do</endpoint>
        <html><![CDATA[<?xml version="1.0" encoding="utf-8" ?>
<j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"></link>

        <g:ui_form>
  <div class="form-group">
    <label for="searchWord">検索ワード</label>
      <input type="text" class="form-control" name="searchWord" placeholder="検索ワード" value="${searchWord}"></input>
  </div>
        <button type="btn" class="btn btn-primary" name="search" value="search" >検索</button>
        </g:ui_form>
        <div class="container">
            <div class="table-responsive">
           <table class="table table-striped table-bordered table-hover"> 検索結果
               <tr><th>#</th><th>ジャケット</th><th>曲名</th></tr>
             <j:forEach items="${parsed.results}" var="jvar_item" indexVar="i">
                <g:evaluate jelly="true" object="true">
                    var trackName = jelly.jvar_item.trackName;
                    var jacketUrl = jelly.jvar_item.artworkUrl60;
                    var idx = jelly.i + 1 + '';
                </g:evaluate>
                 <tr>
                     <td>${idx}</td>
                     <td><img src="${jacketUrl}" /></td>
                     <td>${trackName}</td>
                 </tr>
             </j:forEach>
            </table> 
            </div>
    </div>
</j:jelly>]]></html>
        <name>iTunesSearchPage</name>
        <processing_script><![CDATA[try { 
    var r = new sn_ws.RESTMessageV2('x_276087_request_p.iTunesSearch', 'Default GET');

    var searchWord = searchWord;
	
	//指定された名前のRESTメッセージ関数変数をRESTメッセージレコードから指定された値に設定。
    gs.info('searchWord = ' + searchWord);
    r.setStringParameterNoEscape('term', searchWord);
    r.setStringParameterNoEscape('country', 'jp');
    r.setStringParameterNoEscape('lang', 'ja_jp');
    r.setStringParameterNoEscape('media', 'music');
    r.setStringParameterNoEscape('attribute', 'artistTerm');
　
	//Rest実行
    var response = r.execute();
    var responseBody = response.getBody();
    var httpStatus = response.getStatusCode();

	//エンコード戻す
    var parser = new global.JSON();
    var parsed = parser.decode(responseBody);
	
	//文字列変換
	var arr = JSON.stringify(parsed);
	var arrR = arr["results"];
	
	
	var obj2 = JSON.parse(arr);

	
	var str = parser.encode(responseBody);
	var obj = JSON.parse(str);
	var test = obj.results;

	//初期化
	var gr = new GlideRecord('x_276087_request_p_music_record_test');
	gr.initialize();

	//Insert Data
	gr.setValue('sys_jacket','test1');
	gr.setValue('sys_song_name' , obj);
	gr.insert();

}
catch(ex) {
 //エラー
 var message = ex.getMessage();
}]]></processing_script>
        <sys_class_name>sys_ui_page</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2018-10-02 02:09:01</sys_created_on>
        <sys_id>b8d9ab07db742700870a5901cf96190a</sys_id>
        <sys_mod_count>59</sys_mod_count>
        <sys_name>iTunesSearchPage</sys_name>
        <sys_package display_value="request_post" source="x_276087_request_p">2fdab6bedbb8e300870a5901cf96199f</sys_package>
        <sys_policy/>
        <sys_scope display_value="request_post">2fdab6bedbb8e300870a5901cf96199f</sys_scope>
        <sys_update_name>sys_ui_page_b8d9ab07db742700870a5901cf96190a</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2018-10-04 03:51:31</sys_updated_on>
    </sys_ui_page>
</record_update>
